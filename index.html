<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #74ebd5, #9face6);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: #fff;
            padding: 25px;
            width: 100%;
            max-width: 480px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        h2 {
            text-align: center;
            margin-bottom: 15px;
        }

        label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }

        input, button {
            width: 100%;
            padding: 10px;
            margin-top: 6px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #45a049;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }

        th, td {
            border-bottom: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f2f2f2;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 6px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .total {
            margin-top: 10px;
            font-weight: bold;
            text-align: right;
        }

        .export {
            background: #2196F3;
            margin-top: 10px;
        }

        .export:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üïí ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£</h2>

    <!-- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
    <input type="text" id="username" placeholder="‡πÄ‡∏ä‡πà‡∏ô 65001">
    <button onclick="loadUser()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>

    <!-- ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ -->
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£</label>
    <input type="date" id="date">

    <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
    <input type="time" id="start">

    <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
    <input type="time" id="end">

    <button onclick="addShift()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£</button>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
    <table>
        <thead>
            <tr>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                <th>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</th>
                <th>‡∏•‡∏ö</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div class="total">
        ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalHours">0</span> ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
    </div>

    <button class="export" onclick="exportCSV()">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Excel</button>
</div>

<script>
    let currentUser = "";
    let shifts = [];

    function loadUser() {
        const username = document.getElementById("username").value.trim();
        if (!username) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
            return;
        }

        currentUser = "duty_" + username;
        shifts = JSON.parse(localStorage.getItem(currentUser)) || [];
        loadData();
    }

    function saveData() {
        if (currentUser) {
            localStorage.setItem(currentUser, JSON.stringify(shifts));
        }
    }

    function loadData() {
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";
        let total = 0;

        shifts.forEach((s, i) => {
            total += s.hours;

            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${s.date}</td>
                <td>${s.start} - ${s.end}</td>
                <td>${s.hours.toFixed(2)}</td>
                <td><button class="delete-btn" onclick="deleteRow(${i})">üóëÔ∏è</button></td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById("totalHours").innerText = total.toFixed(2);
    }

    function addShift() {
        if (!currentUser) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
            return;
        }

        const date = document.getElementById("date").value;
        const start = document.getElementById("start").value;
        const end = document.getElementById("end").value;

        if (!date || !start || !end) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
            return;
        }

        const startTime = new Date("1970-01-01T" + start);
        const endTime = new Date("1970-01-01T" + end);

        let hours = (endTime - startTime) / (1000 * 60 * 60);
        if (hours < 0) hours += 24;

        shifts.push({ date, start, end, hours });
        saveData();
        loadData();
    }

    function deleteRow(index) {
        shifts.splice(index, 1);
        saveData();
        loadData();
    }

    function exportCSV() {
        if (shifts.length === 0) {
            alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å");
            return;
        }

        let csv = "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°,‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î,‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á\n";
        shifts.forEach(s => {
            csv += `${s.date},${s.start},${s.end},${s.hours.toFixed(2)}\n`;
        });

        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£.csv";
        a.click();
    }
</script>

</body>
</html>
